pipeline {
    agent any	 

    /* environment { */
    /*     AWS_ACCESS_KEY_ID = credentials('AWS_ACCESS_KEY_ID') */
    /*     AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY') */
    /* } */

    stages {
        stage('Dev Test') {
            steps {
                withDockerContainer(image: 'mattermost/mattermost-marketplace-build:sep-3-2019') {
                    sh 'serverless deploy --verbose --stage test'
                }
                /* withDockerContainer(args: ''' */
                /*     invoke --stage test --function server --data '{"PathParameters":{"proxy":"/api/v1/plugins"}, "httpMethod": "GET"}' */
                /* ''', image: 'mattermost/mattermost-marketplace-build:sep-3-2019') */
            }
        }

        /* stage('Staging') { */
        /*     when { expression { */
        /*         env.BRANCH_NAME == 'staging' */	
        /*     } } */

        /*     steps { */	
        /*         withDockerContainer(args: '', image: 'mattermost/mattermost-marketplace-build:sep-3-2019') { */
        /*             sh ''' */
        /*                 serverless deploy --stage staging --region us-east-1' */
        /*                 serverless invoke --stage staging --function server --data '{"PathParameters":{"proxy":"/api/v1/plugins"}, "httpMethod": "GET"}' */
        /*             ''' */
        /*         } */
        /*     } */
        /* } */

        /* stage('Production') { */
        /*     when { expression { */
        /*         env.BRANCH_NAME == 'production' */	
        /*     } } */

        /*     steps { */	
        /*         withDockerContainer(args: '', image: 'mattermost/mattermost-marketplace-build:sep-3-2019') { */
        /*             sh ''' */
        /*                 serverless deploy --stage production --region us-east-1' */
        /*                 serverless invoke --stage production --function server --data '{"PathParameters":{"proxy":"/api/v1/plugins"}, "httpMethod": "GET"}' */
        /*             ''' */
        /*         } */
        /*     } */
        /* } */

	stage('Teardown') {
	    steps {
                withDockerContainer(args: 'remove --stage test', image: 'mattermost/mattermost-marketplace-build:sep-3-2019')
            }
	}
    }
}
